<?xml version="1.0" encoding="UTF-8" ?>
<!DOCTYPE mapper PUBLIC "-//mybatis.org//DTD Mapper 3.0//EN" "http://mybatis.org/dtd/mybatis-3-mapper.dtd" >
<mapper namespace="com.bc.app.server.mapper.GoodsMapper">

    <resultMap id="GoodsMap" type="com.bc.app.server.entity.Goods">
        <result property="id" column="id" />
        <result property="goodsName" column="goodsName" />
        <result property="goodsPhotos" column="goodsPhotos" />
        <result property="attrList" column="attrList" />
        <result property="goodsUnit" column="goodsUnit" />
        <result property="goodsTypeId" column="goodsTypeId" />
        <result property="goodsTypeId" column="goodsTypeId" />
        <result property="stockNum" column="stockNum" />
        <result property="x" column="x" />
        <result property="y" column="y" />
        <collection property="goodsSpecList" column="id" javaType="List" ofType="goodsSpec" select="getGoodsSpecList"></collection>
    </resultMap>

    <select id="getGoodsList" parameterType="map" resultMap="GoodsMap">
        select
        g.id,
        g.goods_name as goodsName,
        g.goods_photos as goodsPhotos,
        g.goods_no as goodsNo,
        g.attr_list as attrList,
        g.goods_unit as goodsUnit,
        g.goods_type_id as goodsTypeId,
        g.residual_number as stockNum,
        g.x,
        g.y
        from
        t_goods g
        where
        g.delete_status = '0'
        and g.enterprise_id = #{enterpriseId}
        <if test="keyword !=null and keyword != ''">
            and (
            g.goods_name like concat('%', #{keyword},'%')
            or g.goods_no like concat('%', #{keyword},'%')
            )
        </if>
        order by g.create_time desc
    </select>

    <select id="getGoodsSpecList" resultType="goodsSpec" parameterType="string">
        select * from t_goods_spec where goods_id = #{goodsId}
    </select>

    <select id="selectById" parameterType="string" resultType="com.bc.app.server.entity.Goods">
        select
        g.id,
        g.goods_name as goodsName,
        g.goods_photos as goodsPhotos,
        g.goods_no as goodsNo,
        g.attr_list as attrList,
        gt.id as goodsTypeId,
        gt.name as goodsTypeName
        from
        t_goods g
        left join t_goods_type gt on  gt.id = g.goods_type_id
        where g.id=#{id}
    </select>


</mapper>